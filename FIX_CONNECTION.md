# Fix MongoDB Authentication Error

## The Problem
You're getting `bad auth : Authentication failed` because the connection string has incorrect credentials.

## Common Issues & Solutions

### Issue 1: Special Characters in Password
If your MongoDB password contains special characters like: `@`, `#`, `$`, `%`, `&`, `+`, `/`, `=`, `?`, etc., you **MUST** URL-encode them.

**Special Character Encoding:**
- `@` → `%40`
- `#` → `%23`
- `$` → `%24`
- `%` → `%25`
- `&` → `%26`
- `+` → `%2B`
- `/` → `%2F`
- `=` → `%3D`
- `?` → `%3F`

### Issue 2: Connection String Format
Your connection string should look like this:
```
mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/attendance-portal?retryWrites=true&w=majority
```

**Important:**
- Replace `username` with your actual database username
- Replace `password` with your actual password (URL-encode if needed)
- Replace `cluster0.xxxxx` with your actual cluster address
- Include `/attendance-portal` before the `?` (this is the database name)

## Step-by-Step Fix

### Step 1: Get Your Connection String from MongoDB Atlas
1. Go to MongoDB Atlas dashboard
2. Click **"Connect"** on your cluster
3. Choose **"Connect your application"**
4. Copy the connection string (it will have `<password>` placeholder)

### Step 2: URL-Encode Your Password (if needed)
If your password has special characters, use an online tool:
- Visit: https://www.urlencoder.org/
- Paste your password
- Copy the encoded version

**Example:**
- Original password: `MyP@ss#123`
- Encoded password: `MyP%40ss%23123`

### Step 3: Build Your Connection String
Replace the parts in this template:
```
mongodb+srv://YOUR_USERNAME:YOUR_ENCODED_PASSWORD@YOUR_CLUSTER.mongodb.net/attendance-portal?retryWrites=true&w=majority
```

**Example:**
- Username: `admin`
- Password: `MyP@ss#123` (encoded: `MyP%40ss%23123`)
- Cluster: `cluster0.abc123.mongodb.net`
- Final string: `mongodb+srv://admin:MyP%40ss%23123@cluster0.abc123.mongodb.net/attendance-portal?retryWrites=true&w=majority`

### Step 4: Add to .env.local
1. Create a `.env.local` file in your project root (if it doesn't exist)
2. Add this line:
   ```
   MONGODB_URI=mongodb+srv://admin:MyP%40ss%23123@cluster0.abc123.mongodb.net/attendance-portal?retryWrites=true&w=majority
   ```
3. Replace with YOUR actual connection string

### Step 5: Restart Your Development Server
1. Stop your server (Ctrl+C)
2. Start it again: `npm run dev`

## Quick Test
If you're not sure if your password needs encoding, try this:
1. Use a simple password without special characters when creating the MongoDB user
2. Or use the autogenerated password from MongoDB Atlas (it's usually safe)

## Still Not Working?
1. **Verify your username and password** in MongoDB Atlas:
   - Go to Security → Database Access
   - Check your username
   - If you forgot the password, delete and recreate the user

2. **Check Network Access:**
   - Go to Security → Network Access
   - Make sure you have `0.0.0.0/0` (Allow from anywhere) added

3. **Verify the connection string:**
   - Make sure there are no extra spaces
   - Make sure the database name (`attendance-portal`) is included before the `?`
   - Make sure the password is correctly encoded

